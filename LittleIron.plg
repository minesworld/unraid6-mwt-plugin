<?xml version='1.0' standalone='yes'?>

<!-- PLUGIN DEFINITIONS -->
<!DOCTYPE PLUGIN [
  <!ENTITY name      "LittleIron">
  <!ENTITY author    "Michael Keller, minesworld">
  <!ENTITY version   "0.2.1">
  <!ENTITY repo      "https://minesworld.dyndns.org:1037/unraid6/files">
  <!ENTITY pluginURL "&repo;/&name;.plg">
  <!ENTITY plugin    "/boot/config/plugins/&name;">
  <!ENTITY emhttp    "/usr/local/emhttp/plugins/&name;">
]>

<PLUGIN  name="&name;"
     author="&author;"
     version="&version;"
     pluginURL="&pluginURL;"
     min="6.6.6"
>

<CHANGES>

###2021.01.27
- First version
</CHANGES>

<FILE Name="&emhttp;/README.md">
<INLINE>
LittleIron
System for unRAID 6
</INLINE>
</FILE>

<!--
<FILE Name="&emhttp;LittleIron.png" Type="base64">
<INLINE>

</INLINE>
</FILE>
-->

<!--
<FILE Name="&plugin;/minesworld-CA.crt" Type="base64">
<INLINE>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUcwekNDQkx1Z0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRMEZBRENCb0RFTE1Ba0dBMVVFQmhNQ1JFVXgKRHpBTkJnTlZCQWdUQmtobGMzTmxiakVQTUEwR0ExVUVCeE1HVW05a1oyRjFNUnd3R2dZRFZRUUtFeE50YVc1bApjM2R2Y214a0xYTmxjblpwWTJWek1SWXdGQVlEVlFRTEV3MUpWQ0JrWlhCaGNuUnRaVzUwTVJZd0ZBWURWUVFECkV3MXRhVzVsYzNkdmNteGtMVU5CTVNFd0h3WUpLb1pJaHZjTkFRa0JGaEpwYm1adlFHMXBibVZ6ZDI5eWJHUXUKWkdVd0hoY05NakF3TXpFeU1UazFNREEwV2hjTk16QXdNekV3TVRrMU1EQTBXakNCb0RFTE1Ba0dBMVVFQmhNQwpSRVV4RHpBTkJnTlZCQWdUQmtobGMzTmxiakVQTUEwR0ExVUVCeE1HVW05a1oyRjFNUnd3R2dZRFZRUUtFeE50CmFXNWxjM2R2Y214a0xYTmxjblpwWTJWek1SWXdGQVlEVlFRTEV3MUpWQ0JrWlhCaGNuUnRaVzUwTVJZd0ZBWUQKVlFRREV3MXRhVzVsYzNkdmNteGtMVU5CTVNFd0h3WUpLb1pJaHZjTkFRa0JGaEpwYm1adlFHMXBibVZ6ZDI5eQpiR1F1WkdVd2dnSWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUNEd0F3Z2dJS0FvSUNBUURPd2dwNi9HazFwdmlnCjVrTXl1elM3d1I5ZmJBamVNSGJYdGFvOXlvRkVjSTYyUUovcUF5NEI5bG1TUjFHWDhib0lYR2FpYWI1Qmd1eWUKRlVIVDZIRFhRVTdVS05QeDlqS2RUS081Qjhqc2ZxMCswYkowUVg4c2p4bXdRRW9SY1RvZ3VLeGM5cGVtVjRzYgozVHhDaGZHUjZTakN6ODRTYjlsdDQwQ3NGMUlhcmZ5dXFrN2hpWHdFKzFsL2NkVnFpaXpTREExSTdwNnU3dEYrCm9TM3NKUFRFOTZEZkozckd4QVF4N0Uwck02VUdJNlg2K1piRVV6d1JIMTNSL2tEVm0xeWtyazlSRGgwNUlCTGkKYTU4RGpKc2x6S3RJcUU2b3o3YzE0TGxrTzZOanUzYzhBWjJYOEplSWNLeC9vekIzYU51Qk5CcjVRdEhWUlFUVwpiS0VuWE5IZHFCVzNGRnJEWFJXWkl6R1RLcnRxS3I1YS9RUC92SzhtN3lLNzBWOUFiV3ArTytqT2hwaEJ3Nm9lCm9jWG1iUWRCUnhhV3hQa2drTGdndWQyM01RaWZFcVZEeVRQS2ZiLzJsSmgrTzlCM3Jrb0hDYUgzUlVwZzZoQlMKTm5VTkhYTWY5UkRnNXJBTm5jcnAwK3NtWU9WbHViL1hnRmNFWkMxUnoxeWhrd2dwNlpsSnJxTW5lK3lZbFhyVApISHlaU25jM3A3Rk9hQTFJRWdRL1dPb2tld0MxQk12TFozb2NHMk9XcG5PWXBLWVJjNUxUQ2tsd3dIQ3RuMkUxCk44Y3cvSXozQTc2bGtXWjVweGRpZERsbERSd0FwMWg2RG9CbndIb1Q0RkFVTHNidVBmUmg1bmhqZXRGQytNamMKMGJIS1pMZXpQWWdOcWFTbTJXRHJBcm9WOCtEK0JRSURBUUFCbzRJQkZEQ0NBUkF3SFFZRFZSME9CQllFRkF4YQptZEllNCtvZ1JKLzBLMDV1LzdhWXdIV3NNSUhOQmdOVkhTTUVnY1V3Z2NLQUZBeGFtZEllNCtvZ1JKLzBLMDV1Ci83YVl3SFdzb1lHbXBJR2pNSUdnTVFzd0NRWURWUVFHRXdKRVJURVBNQTBHQTFVRUNCTUdTR1Z6YzJWdU1ROHcKRFFZRFZRUUhFd1pTYjJSbllYVXhIREFhQmdOVkJBb1RFMjFwYm1WemQyOXliR1F0YzJWeWRtbGpaWE14RmpBVQpCZ05WQkFzVERVbFVJR1JsY0dGeWRHMWxiblF4RmpBVUJnTlZCQU1URFcxcGJtVnpkMjl5YkdRdFEwRXhJVEFmCkJna3Foa2lHOXcwQkNRRVdFbWx1Wm05QWJXbHVaWE4zYjNKc1pDNWtaWUlCQURBUEJnTlZIUk1CQWY4RUJUQUQKQVFIL01BNEdBMVVkRHdFQi93UUVBd0lCaGpBTkJna3Foa2lHOXcwQkFRMEZBQU9DQWdFQVJqV3ZxdWhWYW4zeApRMFJwTWNjc2wyVmF6K3ZUR1BtRXdBeXR3WFIrWGMzblRDMXk0aXRRS1pNS3ZCQisxanhxVG9iZ3k0bVJYK1YwCkZuSUFaUUszMVNycTd6andrWUVPZ0JJeCtyZ3BnaW5ldlhFSURXUCtJN2xuR2dpTUFUR29PMi85anV2YlhudFMKRDhEbG03Q2E4RWdidmU2cWs3anZ3WEpKMVpxMDNsemZ4dW5mWlp4TjE5Sk9hSUd1NlpRYWVRUC92czFtSXFlbApqVENGSTNlN3J1U0J4V00weTRzVC90cDM0TmNaK21pcDJnalgwcXk0STZWMC9XUU9rQVNSZFpHcmZXd3JwOUJTCmxIUFNjdklFU2ZBWUpnSDNRVHh6b0t6RFhId2w2RjJleEZ6OE5XRUlYOG9pWnNpQWRUTzZsSENFK1NaNU9ic2kKbkRHMDRGNFU2bmlFUW9lQStWaVk3dDdLb3hERWN2a0F2WjF0ck9IckRFeS94Tml4bTZydUpjWXVFd0svUnF0ZgpYdHdMUjZOallPbVNJWEVaK09VV0xiU1QvbWl0OE1mU2tIeWNoTWp1Ni9YM1FFS20zQVdlWEs2MUdCdkRMUzM1Cm9lSXZjRmpvdVZCbThoaU5hSEpnRXYxU0xib2RZRUFKN0Yzck5XMHo5ODRKZTZFalZrUkNsR21WaWlCMjJTZ3IKaU1jc1Y2Uk1BRmd0ZTNpU2VGcUM4QWRBbEk2cFQyMHhWV2t4QVZSeE5GU0p5V0l6YXFmV29MNnVUOWZyZGdoeApIaG9xYXlGR3ZIbjZnUTVjbVZmeEdveTZDNDBJL3JIekZzS3Z0aXhidkhycmYyTmdSSnhOQnY3b3lTRmxiOU5VCmtxWlJKTkhxNUNnMW1iVFgyL3FMc0tnN25jY29Ienc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
</INLINE>
</FILE>
-->

<FILE Run="/bin/bash">
<INLINE>

MWTBASENAME="MWTbase"
MWTBASEPKG="${MWTBASENAME}.&version;.x86_64.tgz"
MTWBASEURL="&repo;/public/${MWTBASEPKG}"

LIRONNAME="LittleIron"
LIRONPKG="${LIRONNAME}.&version;.x86_64.tgz"
LIRONURL="&repo;/customers/${LIRONPKG}"

MINESWORLDCA="-----BEGIN CERTIFICATE-----
MIIG0zCCBLugAwIBAgIBADANBgkqhkiG9w0BAQ0FADCBoDELMAkGA1UEBhMCREUx
DzANBgNVBAgTBkhlc3NlbjEPMA0GA1UEBxMGUm9kZ2F1MRwwGgYDVQQKExNtaW5l
c3dvcmxkLXNlcnZpY2VzMRYwFAYDVQQLEw1JVCBkZXBhcnRtZW50MRYwFAYDVQQD
Ew1taW5lc3dvcmxkLUNBMSEwHwYJKoZIhvcNAQkBFhJpbmZvQG1pbmVzd29ybGQu
ZGUwHhcNMjAwMzEyMTk1MDA0WhcNMzAwMzEwMTk1MDA0WjCBoDELMAkGA1UEBhMC
REUxDzANBgNVBAgTBkhlc3NlbjEPMA0GA1UEBxMGUm9kZ2F1MRwwGgYDVQQKExNt
aW5lc3dvcmxkLXNlcnZpY2VzMRYwFAYDVQQLEw1JVCBkZXBhcnRtZW50MRYwFAYD
VQQDEw1taW5lc3dvcmxkLUNBMSEwHwYJKoZIhvcNAQkBFhJpbmZvQG1pbmVzd29y
bGQuZGUwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQDOwgp6/Gk1pvig
5kMyuzS7wR9fbAjeMHbXtao9yoFEcI62QJ/qAy4B9lmSR1GX8boIXGaiab5Bguye
FUHT6HDXQU7UKNPx9jKdTKO5B8jsfq0+0bJ0QX8sjxmwQEoRcToguKxc9pemV4sb
3TxChfGR6SjCz84Sb9lt40CsF1Iarfyuqk7hiXwE+1l/cdVqiizSDA1I7p6u7tF+
oS3sJPTE96DfJ3rGxAQx7E0rM6UGI6X6+ZbEUzwRH13R/kDVm1ykrk9RDh05IBLi
a58DjJslzKtIqE6oz7c14LlkO6Nju3c8AZ2X8JeIcKx/ozB3aNuBNBr5QtHVRQTW
bKEnXNHdqBW3FFrDXRWZIzGTKrtqKr5a/QP/vK8m7yK70V9AbWp+O+jOhphBw6oe
ocXmbQdBRxaWxPkgkLggud23MQifEqVDyTPKfb/2lJh+O9B3rkoHCaH3RUpg6hBS
NnUNHXMf9RDg5rANncrp0+smYOVlub/XgFcEZC1Rz1yhkwgp6ZlJrqMne+yYlXrT
HHyZSnc3p7FOaA1IEgQ/WOokewC1BMvLZ3ocG2OWpnOYpKYRc5LTCklwwHCtn2E1
N8cw/Iz3A76lkWZ5pxdidDllDRwAp1h6DoBnwHoT4FAULsbuPfRh5nhjetFC+Mjc
0bHKZLezPYgNqaSm2WDrAroV8+D+BQIDAQABo4IBFDCCARAwHQYDVR0OBBYEFAxa
mdIe4+ogRJ/0K05u/7aYwHWsMIHNBgNVHSMEgcUwgcKAFAxamdIe4+ogRJ/0K05u
/7aYwHWsoYGmpIGjMIGgMQswCQYDVQQGEwJERTEPMA0GA1UECBMGSGVzc2VuMQ8w
DQYDVQQHEwZSb2RnYXUxHDAaBgNVBAoTE21pbmVzd29ybGQtc2VydmljZXMxFjAU
BgNVBAsTDUlUIGRlcGFydG1lbnQxFjAUBgNVBAMTDW1pbmVzd29ybGQtQ0ExITAf
BgkqhkiG9w0BCQEWEmluZm9AbWluZXN3b3JsZC5kZYIBADAPBgNVHRMBAf8EBTAD
AQH/MA4GA1UdDwEB/wQEAwIBhjANBgkqhkiG9w0BAQ0FAAOCAgEARjWvquhVan3x
Q0RpMccsl2Vaz+vTGPmEwAytwXR+Xc3nTC1y4itQKZMKvBB+1jxqTobgy4mRX+V0
FnIAZQK31Srq7zjwkYEOgBIx+rgpginevXEIDWP+I7lnGgiMATGoO2/9juvbXntS
D8Dlm7Ca8Egbve6qk7jvwXJJ1Zq03lzfxunfZZxN19JOaIGu6ZQaeQP/vs1mIqel
jTCFI3e7ruSBxWM0y4sT/tp34NcZ+mip2gjX0qy4I6V0/WQOkASRdZGrfWwrp9BS
lHPScvIESfAYJgH3QTxzoKzDXHwl6F2exFz8NWEIX8oiZsiAdTO6lHCE+SZ5Obsi
nDG04F4U6niEQoeA+ViY7t7KoxDEcvkAvZ1trOHrDEy/xNixm6ruJcYuEwK/Rqtf
XtwLR6NjYOmSIXEZ+OUWLbST/mit8MfSkHychMju6/X3QEKm3AWeXK61GBvDLS35
oeIvcFjouVBm8hiNaHJgEv1SLbodYEAJ7F3rNW0z984Je6EjVkRClGmViiB22Sgr
iMcsV6RMAFgte3iSeFqC8AdAlI6pT20xVWkxAVRxNFSJyWIzaqfWoL6uT9frdghx
HhoqayFGvHn6gQ5cmVfxGoy6C40I/rHzFsKvtixbvHrrf2NgRJxNBv7oySFlb9NU
kqZRJNHq5Cg1mbTX2/qLsKg7nccoHzw=
-----END CERTIFICATE-----"

LITTLEIRONCA="-----BEGIN CERTIFICATE-----
MIIG2TCCBMGgAwIBAgIBADANBgkqhkiG9w0BAQ0FADCBojELMAkGA1UEBhMCREUx
DzANBgNVBAgTBkhlc3NlbjEVMBMGA1UEBxMMR3JlaWZlbnN0ZWluMSAwHgYDVQQK
ExdtaW5lc3dvcmxkLXRlY2hub2xvZ2llczENMAsGA1UECxMEcm9vdDEXMBUGA1UE
AxMObGl0dGxlLWlyb24tQ0ExITAfBgkqhkiG9w0BCQEWEmNhQGxpdHRsZS1pcm9u
LmNvbTAeFw0yMDA3MzExNTQ4NDVaFw0zMDA3MjkxNTQ4NDVaMIGiMQswCQYDVQQG
EwJERTEPMA0GA1UECBMGSGVzc2VuMRUwEwYDVQQHEwxHcmVpZmVuc3RlaW4xIDAe
BgNVBAoTF21pbmVzd29ybGQtdGVjaG5vbG9naWVzMQ0wCwYDVQQLEwRyb290MRcw
FQYDVQQDEw5saXR0bGUtaXJvbi1DQTEhMB8GCSqGSIb3DQEJARYSY2FAbGl0dGxl
LWlyb24uY29tMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA4JBHFNH/
rznmLgOfmqeW5M9rAqP6VGxo6kRm0cvxllJJRzdiFndo1YIfBeIb+1/YAmQcIWHL
9GD6glQUj4X4oQ1Vdat/g6h6hkp4LWV493B4VE00GIqIjHHMVOPNCbOQs9+t7tOj
IBIsd74DVVeqhiOhBqJWIgTu6Tg1a27nDXfC7JEdPgVhZ8B6A6nWh89JNTSyxRwo
KWHjFgJPboVpGp3WBoiTFPmTCPfUwhWcs/HK4P8Iuka5wUMGvvNy02/G89HX3cQ8
T0VRO82TnR6/14Wh2EVbJ4XEVoxnJFhVeLYm/4lQYQgFVbsG6MS43hmvWOwxLRBw
lq+zb7cd/UwtgXkFQBp9rfn3/JCzWv38BQrOlhC89aoqgrVa9AURIf7KEQ+wMB8M
C1owoBrY+G2n5cdP6Dqiv/+A80D7MrT6gm5vo4j8SPdXjt4KIa5CEa79qITv490X
/Wf+r3kUrE7qS0gYB13n6PY0eLUD256oFKUSpO3fRw5kZY5zjj/h4RyVPUrex1Qe
ZRfdCl1tuBMGD3ReSKo0Rki8lmSXNOK8NMJHNDtIG+iAwIjMKITv+NXt+AYGdQZD
n8Lk97vXGxZ+6dOG/wsJX3ZF4lvTnb6sREqeOVTqn1FLt8zDUwk4E9ci7KdWkUGv
K7lwn9juzuYBKZbXsYlpZWrPVLy5e+gIJH0CAwEAAaOCARYwggESMB0GA1UdDgQW
BBRnc6HAQVB6G1eDJQotFgFUEF9TcDCBzwYDVR0jBIHHMIHEgBRnc6HAQVB6G1eD
JQotFgFUEF9TcKGBqKSBpTCBojELMAkGA1UEBhMCREUxDzANBgNVBAgTBkhlc3Nl
bjEVMBMGA1UEBxMMR3JlaWZlbnN0ZWluMSAwHgYDVQQKExdtaW5lc3dvcmxkLXRl
Y2hub2xvZ2llczENMAsGA1UECxMEcm9vdDEXMBUGA1UEAxMObGl0dGxlLWlyb24t
Q0ExITAfBgkqhkiG9w0BCQEWEmNhQGxpdHRsZS1pcm9uLmNvbYIBADAPBgNVHRMB
Af8EBTADAQH/MA4GA1UdDwEB/wQEAwIBhjANBgkqhkiG9w0BAQ0FAAOCAgEAbqBV
GlmaRuMYO47SDsws11lCwn/7nCqyxS+eWixyK7nPLOE6XUcQrvt/NpNVd4qV6B1N
W1Ol14JZatnaRZdLABXqU9/h6IZOS2q6vvQzGre2fdPep5+Duyda0e3/XEn1np1H
SSN18JA0AzFVEuiqdI1oxgXNRlowJbJmYv+YSiC06QfpaIVN7u/xILNtW1qAOKgO
yzzmbuywAa+FJzuXTC9PXIYWVPDvwzZQDkjewlL84X1JrXQI7EjB08Y/kcSaMqUs
KMEoEbV0vd4z+eOKx/6Hq4QDHdR6oH4Bw0aFEML4fojSrrac9+BBiGq5koqUFuaW
5IGwrMd8Jt9ozpaITkAN+ERLo7wa5zzoEIAHWqviQErPDVHI9YdnA24pG8hRH9ye
qmEVODFQZZj4xgkwL4fb0W+jLQGNtBRUFn2sTHjrqBJvg+SE4dcdzCII3YqmLFPr
lwsbtx9dfh8pkTzV5GcNiGKVbUB3q4R20R1zKOSJ+BEfKLhlvFt+e4sXv/o1zKFa
0iWWmy/HZQ/tLCkZwZgJmq89kkODKqehevbYVScz5Jg2tfwVoQgKtbVUpm67yfwV
sgezdnECvwtut3wgr418LFUGvnqKEmRSwQNTeSmGz/FlihcKRYLuV/a0TuojJ0BU
pRtEQGGcEvGl/WzaSgorMCLTn12o8Z0itZgZdwo=
-----END CERTIFICATE-----"


SERVICESCA="-----BEGIN CERTIFICATE-----
MIIGzzCCBLegAwIBAgIBATANBgkqhkiG9w0BAQ0FADCBojELMAkGA1UEBhMCREUx
DzANBgNVBAgTBkhlc3NlbjEVMBMGA1UEBxMMR3JlaWZlbnN0ZWluMSAwHgYDVQQK
ExdtaW5lc3dvcmxkLXRlY2hub2xvZ2llczENMAsGA1UECxMEcm9vdDEXMBUGA1UE
AxMObGl0dGxlLWlyb24tQ0ExITAfBgkqhkiG9w0BCQEWEmNhQGxpdHRsZS1pcm9u
LmNvbTAeFw0yMDA3MzExNTQ5MDBaFw0zMDA3MjgxNTQ5MDBaMIGYMQswCQYDVQQG
EwJERTEPMA0GA1UECBMGSGVzc2VuMRUwEwYDVQQHEwxHcmVpZmVuc3RlaW4xFzAV
BgNVBAoTDmxpdHRsZS1pcm9uLUNBMQswCQYDVQQLEwJJVDEUMBIGA1UEAxMLc2Vy
dmljZXMtQ0ExJTAjBgkqhkiG9w0BCQEWFnNlcnZpY2VzQG1pbmVzd29ybGQuZGUw
ggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQCuFEBfvKp/ilEW9pg7zzew
MZWL7cxemcDsHEuw7R1IPJpSPWRQ3nyXyzWTcqW61vwG9w6tnLamTK5dm/tSxQBy
SF3lkVTkqhCDZWOZX3ZeGITLEugCcYaYCBBtMUBbpZXFdRW2AGjtvOUoZYjRbyal
+Zsw+3cVWf9UM5RqMlHjUWuFR4yUAqg1kXJhhPwA2y+9sBJKGtks2x6eBNcj3whm
OURJV1XUvIG/MqScAFLLims8lFhxbBoXV2Z2p2P3Yb4MF8FZTlIKk89ZUIj1mnPp
jyu12XQDgjZRuQLJlDr/vj+E/OHU19uy0E4/JZG6jh5LnI1tnhuXzYgW8nOFZHdD
arAO/lZ8A5k90bZmwPtOBplgPQcVLh2L57qUcjRyYCy8OVf9bmaBmbLaFW3foh0P
RNJv6Y6j7w9RUK/6Z+j2N0ohC9auqxGebbpEd4/IA6mActLHQEPlp+k5za3C73I7
Q2u23hZA7swBCydYD3Hr4v3C+LHQZPnn6MOIjExd1Fs5riNkCZcmnUNsbuNczIXS
D16MFCOrR7ZYm8ELQrtYI/ZA1R2BiQwKD0FybS92lUIyEFGbM3wz314RjymaqTEz
Bv5BmUWznmINtz+5tKTcJ27D2x0lGuSKAXqkhGyMKHLpcmMbgsxNBVvkVQVMOrZ1
u+xn2hRFBJnj+8h/EHitCwIDAQABo4IBFjCCARIwHQYDVR0OBBYEFKJaNgPVfKP5
mde+eDml0z6xjk2oMIHPBgNVHSMEgccwgcSAFGdzocBBUHobV4MlCi0WAVQQX1Nw
oYGopIGlMIGiMQswCQYDVQQGEwJERTEPMA0GA1UECBMGSGVzc2VuMRUwEwYDVQQH
EwxHcmVpZmVuc3RlaW4xIDAeBgNVBAoTF21pbmVzd29ybGQtdGVjaG5vbG9naWVz
MQ0wCwYDVQQLEwRyb290MRcwFQYDVQQDEw5saXR0bGUtaXJvbi1DQTEhMB8GCSqG
SIb3DQEJARYSY2FAbGl0dGxlLWlyb24uY29tggEAMA8GA1UdEwEB/wQFMAMBAf8w
DgYDVR0PAQH/BAQDAgGGMA0GCSqGSIb3DQEBDQUAA4ICAQB6YFbvwVgr/On4/O2V
A1V7Ny1rPzspHU6ArpiIilP3bwnm3aBW3r+Wudv686t12Sd+LV2JXDmByN7xwTv9
kp+i5YGC0io24yysY8hmFxv4b4u5Hj61QuLGRoE3S6bTlk/rKxCyIDeRJNnq0qS+
b3e1IdnwTtCyYi/ltXW+kepQ9TfgYdl4mrFLerJGtBSPEikWSoMsRlSO7IM2mWEG
pelMwyqp/dFIttIQNPKnBU+P3AhtTehgZRCEmYyi46SUJVX4WWZy+wo7GAFOh0pX
mzYbNk5aroJHUwkIs4B0KLzZXgMhpv94O/whqgL8YlDQCux9T7rhRfJSvE5wJqSm
NNM1A6BEZvs6PRvOK/DvjTu/WxhM9btjhqeIE3A8Acqiviv4HumqIxCy1So3C1r3
pEgg+XDi0jCEgZkFvq+Dmdi0ztuodNaW2NcP2sDPVAujUnwkt28VHDVCcDnhsHEs
4FjKEaLfeZZLKM3HNAT7K3u5FmJ4TgwuvPO/jKjoBCr2mdwXVvl89n017J1Qttuy
V3b/ev3A/oxvF45LRMm+DWHJlved8NJ+lP1M3mry3eoEXKQ4Zg+DP0m/kKS8mcup
/8vxL4i+YN6Iigr9Hrp31rvi631sUo/pKNUZAZL05n6eTl6+V7keEF1Sz0mfwU8M
Wzcag4lqLFhG+PtPdJt7BiQKBg==
-----END CERTIFICATE-----"

#
# -----------------------------------------
#

install_cert() {
  OLDDIR=$PWD

  cd /etc/ssl/certs
  echo "installing ${1}"

  for X in `find . -lname "${1}.crt"`
  do
    rm $X
  done
  rm "${1}.crt"

  echo "${2}" > "${1}.crt"

  HASH=`openssl x509 -noout -hash -in "${1}.crt"`
  INDEX=0
  while [ -f "${HASH}.${INDEX}" ];
  do
    let INDEX++
  done

  ln -s "${1}.crt" "${HASH}.${INDEX}"

  cd "${OLDDIR}"
}

download() {
  if [ -f "${1}" ]; then
    return $TRUE
  fi

  echo "downloading ${2}"

  AUTHENTICATE=$FALSE
  if [ ! -z "${3}" ]; then
    if [ ! -z "${4}" ]; then
       AUTHENTICATE=$TRUE
    fi
  fi
  if [ $AUTHENTICATE == $TRUE ]; then
      curl --capath /etc/ssl/certs --cert "${3}" --key "${4}" --location --silent --fail "${2}" --output "${1}"
  else
      curl --capath /etc/ssl/certs --location --silent --fail "${2}" --output "${1}"
  fi
}

download_install() {
  local dest="&plugin;/packages/${1}"
  local src=$2

  mkdir -p "&plugin;/packages"
  download "${dest}" "${src}" $4 $5
  download "${dest}.md5" "${src}.md5" $4 $5

  orig_md5=$(/usr/bin/cat ${dest}.md5)
  file_md5=$(/usr/bin/md5sum ${dest})

  if [ "${file_md5:0:32}" != "${orig_md5:0:32}" ]; then
    echo "Wrong '${1}' package md5 hash."
    rm "${dest}" "${dest}.md5"
    exit 1
  else
    echo "installing ${1}"

    tar --overwrite -xzf "${dest}" -C /

    # delete old tgz
    find "&plugin;/packages/${3}."* ! -name *"&version;"* -exec rm {} \;
    # find "&plugin;/packages/${3}."* ! -name *"&version;"* -exec echo {} \;
    # ls -la &plugin;/packages/
  fi
}

#
# -----------------------------------------
#

# DOWNLOAD PUBLIC PKG

install_cert minesworld-CA "${MINESWORLDCA}"
install_cert little-iron-CA "${LITTLEIRONCA}"
install_cert services-CA "${SERVICESCA}"

if [ -d /opt/mwt ]; then
  rm -Rf /opt/mwt
fi

download_install "${MWTBASEPKG}" "${MTWBASEURL}" "${MWTBASENAME}"

# check for client license

if [ ! -f "&plugin;/serviceclient.cpkg.tar" ]; then
  echo "Missing Little Iron license at &plugin;/serviceclient.cpkg.tar"
  exit 0
fi

echo "installing serviceclient.cpkg.tar"

mkdir -p /opt/mwt/etc/serviceclient.cpkg 
chown root:root /opt/mwt/etc/serviceclient.cpkg
chmod 0700 /opt/mwt/etc/serviceclient.cpkg

tar -xf &plugin;/serviceclient.cpkg.tar -C /opt/mwt/etc/

chown -R root:root /opt/mwt/etc/serviceclient.cpkg
chmod 0755 /opt/mwt/etc/serviceclient.cpkg

# DOWNLOAD CUSTOMERS PKG

for X in xqsd serviceclient
do
  if [ -f "/opt/mwt/sbin/${X}" ]; then
    echo "stopping ${X}"
    /opt/mwt/sbin/$X stop
  fi
done

download_install "${LIRONPKG}" "${LIRONURL}" "${LIRONNAME}" /opt/mwt/etc/serviceclient.cpkg/client.cert /opt/mwt/etc/serviceclient.cpkg/client.key

for X in zfstool zfswerkzeug zfsbackup xqs
do
  echo "symlinking to /usr/local/bin/$X"
  if [ -f /usr/local/bin/$X ]; then
    rm /usr/local/bin/$X
  fi
  ln -s /opt/mwt/sbin/$X /usr/local/bin/$X 
done

# RESTART XQSD and SERVICECLIENT

echo "starting xqsd"
/opt/mwt/sbin/xqsd start

echo "starting serviceclient"
/opt/mwt/sbin/serviceclient start /opt/mwt/etc/serviceclient.cpkg

</INLINE>
</FILE>

<!-- PLUGIN REMOVAL SCRIPT -->
<FILE Run="/bin/bash" Method="remove">
<INLINE>

remove_cert() {
  OLDDIR=$PWD

  echo "removing ${1}"

  cd /etc/ssl/certs
  for X in `find . -lname "${1}.crt"`
  do
    rm $X
  done
  rm "${1}.crt"

  cd "${OLDDIR}"
}

echo "+=============================================================================="
echo "| Uninstalling LittleIron"
echo "+=============================================================================="
# Remove plugin related files
remove_cert minesworld-CA
remove_cert little-iron-CA
remove_cert services-CA
rm -rf /usr/local/emhttp/plugins/&name;
rm -rf &plugin;/packages
echo ""
echo "LittleIron plugin uninstalled."
</INLINE>
</FILE>
</PLUGIN>
